<template>
  <Directory
    class="dark"
    bgImage="url('https://images.ctfassets.net/ncgri9n8y2w0/6EbN30EMdczl293bfC69ng/61f04bf4ace1bccbcb7a2e536b055987/SC_linear_pattern_rgb_yellow.png')"
  >
    <template #page-header>
      <Header class="v1">
        <template>
          News
        </template>
        <template #support>
          <p class="dark">
            For the latest happenings at Southern Company Gas
          </p>
        </template>
      </Header>
    </template>


    <PageSection>
      <CategoryNav />

      <CardGroup v-if="posts">
        <Card v-for="post in posts" :key="post.id" :url="'/news/' + post.slug">
          <template v-if="post.featuredImage" #image>
            <g-image :src="post.featuredImage.file.url" />
          </template>

          <template>
            {{ post.title }}
          </template>

          <template #link>
            Read more
          </template>
        </Card>

      </CardGroup>
    </PageSection>

  </Directory>
</template>

<page-query>
  query posts($id: ID!, $name: [String]) {
    categories: blogCategory(id: $id) {
      name
      path
    }
    posts: allContentfulBlogPost(sortBy: "date", order: ASC, filter: {
        categories: {
          contains: $name
        }
      }
    ) {
      edges {
        node {
          title
          slug
          featuredImage {
            file {
              url
            }
          }
          content
        }
      }
    }
  }
</page-query>

<script>
import MarkdownIt from 'markdown-it'

export default {
  metaInfo() {
    return {
      title: "this.$page.post.title",
    }
  },
  computed: {
    posts() {
      return this.$page.posts.edges.map(x => x.node)
    },
    content() {
      const md = new MarkdownIt()

      return md.render(this.posts.content)
    },
  },
}
</script>