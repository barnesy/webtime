<template>
  <Leaf>
    <Header class="v2"
            colColor="rgba(255,255,255, 0.9)"
            padding="3rem"
            :bgImage="'url(' + this.ogImage + ')'"
    >
        <template>{{ $page.post.title }}</template>
        <template #support>{{ $page.post.shortDescription }}</template>
      </Header>
    <PageSection class="narrow" padding="6rem 3rem">

      <g-image v-if="$page.post.featuredImage" :src="$page.post.featuredImage.file.url"/>
     
      <iframe v-if="$page.post.videoid" width="100%" height="641" :src="'https://www.youtube.com/embed/' + $page.post.videoid" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
  
      <div v-html="content" />
    </PageSection>
  </Leaf>
</template>

<page-query>
  query Post($id: ID) {
    post: contentfulBlogPost (id: $id) {
      title
      slug
      shortDescription
      featuredImage {
        file {
          url
        }
      }
      videoid
      content
    }
  }
</page-query>

<script>
import MarkdownIt from 'markdown-it'

let placeholder =  "https://images.ctfassets.net/ncgri9n8y2w0/4TrUKxtHvhJEMH1Ki0P8GO/c61275e1dbcea68f5600dbfe1211e7de/dark-green.png"

export default {
  metaInfo() {
    return {
      title: this.$page.post.title,
      meta: [
        {
          name: 'description',
          content: this.$page.post.title
        },
        {
          property: 'og:title',
          content: this.$page.post.title
        },
        {
          property: 'og:description',
          content: this.$page.post.title
        },
        {
          property: 'og:image',
          content: "https:" + this.ogImage
        },
        {
          property: 'og:url',
          content:  this.$context.url + this.$page.post.slug
        },
      ],
    }
  },
  data() {
    return {
      ogImage: placeholder
    }
  },
  computed: {
    content() {
      const md = new MarkdownIt()

      return md.render(this.$page.post.content)
    },
  },
  mounted() {
    let img = this.$page.post.featuredImage
    this.ogImage = (img) ?  img.file.url : placeholder
  }
}
</script>