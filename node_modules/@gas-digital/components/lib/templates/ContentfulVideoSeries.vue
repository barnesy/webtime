<template>
  <Directory>
    <template #page-header>
      <Header padding="3rem" class="v1 dark" :bgImage="headerFeaturedImage">
        <template>
          {{ $page.post.title }}
        </template>
        <template #support>
            <br />
          {{ $page.post.summary }}
        </template>
      </Header>
    </template>

    <PageSection padding="8rem 3rem 0">
      <iframe v-if="$page.post.youtubeId" width="100%" height="641" :src="'https://www.youtube.com/embed/' + $page.post.youtubeId" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

      <h2>Episodes</h2>
      <CardGroup>
        <Card :url='directory + vid.slug' v-for="vid in $page.post.posts" :key="vid.id">
          <template #image>
            <g-image :src="vid.thumbnail.file.url" />
          </template>

          <template>
            {{ vid.title }}
          </template>

          <template #description>
            {{ vid.summary }}
          </template>
        </Card>
      </CardGroup>
    </PageSection>

    <PageSection class="narrow">
      <div v-html="content" />
    </PageSection>

  </Directory>
</template>

<page-query>
  query Post($id: ID) {
    post: contentfulVideoSeries (id: $id) {
      id
      slug
      title
      summary
      content
      youtubeId
      featuredImage {
        file {
          url
        }
      }
      posts {
        id
        slug
        title
        thumbnail {
          file {
            url
          }
        }
        content
        summary
        youtubeId
      }
    }
  }
</page-query>

<script>
import MarkdownIt from 'markdown-it'

let placeholder =  "https://images.ctfassets.net/ncgri9n8y2w0/4TrUKxtHvhJEMH1Ki0P8GO/c61275e1dbcea68f5600dbfe1211e7de/dark-green.png"

export default {
  metaInfo() {
    return {
      title: this.$page.post.title,
      meta: [
        {
          name: 'description',
          content: this.$page.post.summary
        },
        {
          property: 'og:title',
          content: this.$page.post.title
        },
        {
          property: 'og:description',
          content: this.$page.post.summary
        },
        {
          property: 'og:image',
          content: this.ogImage
        },
        {
          property: 'og:url',
          content: "https://www.southerncompanygas.com/community/" + this.$page.post.slug
        },
      ],
    }
  },
  data() {
    return {
      ogImage: placeholder
    }
  },
  computed: {
    content() {
      const md = new MarkdownIt()
      return md.render(this.$page.post.content)
    },

    directory() {
      console.log(this.$context.category)

       if ( this.$context.category=="Education" ) {
        return('/safety/education/'+ this.$page.post.slug +'/')
       } else {
        return('/community/' + this.$page.post.slug +'/')
       }
    },

    headerFeaturedImage () {
      if (this.$page.post.featuredImage) {
        return "url('https:" + this.$page.post.featuredImage.file.url + "')"
        } else {
        return "url('https://images.ctfassets.net/ncgri9n8y2w0/4TrUKxtHvhJEMH1Ki0P8GO/c61275e1dbcea68f5600dbfe1211e7de/dark-green.png')"
      }
    }
  },
  mounted() {
    let img = this.$page.post.featuredImage
    this.ogImage = (img) ?  img.file.url : placeholder
  }
}
</script>
