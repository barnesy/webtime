<template>
  <Directory
    class="dark"
    bgImage="url('https://images.ctfassets.net/ncgri9n8y2w0/6EbN30EMdczl293bfC69ng/61f04bf4ace1bccbcb7a2e536b055987/SC_linear_pattern_rgb_yellow.png')"
  >
    <template #page-header>
      <Header class="v5">
        <template>
          News
        </template>
        <template #support>
          <p>Featured</p>
          <CardGroup>
            <Card class="small" v-for="{ node } in $page.featured.edges" :key="node.id" :url="'/news/' + node.slug">
              <template v-if="node.featuredImage" #image>
                <g-image :src="node.featuredImage.file.url" :alt="node.featuredImage.description" />
              </template>
              <template #label>Featured</template>
              <template>
               {{ node.title }}
              </template>
            </Card>
          </CardGroup>
        </template>
      </Header>
    </template>

    <PageSection padding="3rem">
      <CategoryNav />

      <CardGroup v-if="$page">
        <Card v-for="{ node } in $page.posts.edges" :key="node.id" :url="'/news/' + node.slug">
          <template v-if="node.featuredImage" #image>
            <g-image :src="node.featuredImage.file.url" />
          </template>

          <template>
            {{ node.title }}
          </template>
        </Card>
      </CardGroup>

      <pager
        class="pager"
        linkClass="page-link"
        v-if="$page.posts.pageInfo.totalPages > 1"
        :info="$page.posts.pageInfo"
      />
    </PageSection>
  </Directory>
</template>

<page-query>
  query Posts($page: Int, $territory: [String]) {
    posts: allContentfulBlogPost(sortBy: "date", order: DESC, perPage: 20, page: $page, filter:{territory:{contains:$territory}}) @paginate {
      totalCount pageInfo {
        totalPages
        currentPage
      } edges {
        node {
          id
          title
          slug
          author
          categories
          content
          publishedDate(format:"MMMM D, Y")
          featuredImage {
            file {
              url
            }
          }
        }
      }
    }

    featured:allContentfulBlogPost(sortBy: "publishedDate", order: DESC, limit: 6, filter:{categories:{contains:"Featured"}, territory: {contains: $territory}}) {
      edges {
        node {
          id
          title
          slug
          categories
          publishedDate(format:"MMMM D, Y")
          anchorText
          featuredImage {
            description
            file {
              url
            }
          }
        }
      }
    }
  }
</page-query>

<script>
  import { Pager } from 'gridsome'

  export default {
     metaInfo() {
    return {
      title: "News",
      meta: [
        {
          name: 'description',
          content: "The latest updates from Southern Company Gas."
        },
        {
          property: 'og:title',
          content: "News"
        },
        {
          property: 'og:description',
          content: "The latest updates from Southern Company Gas."
        },
        {
          property: 'og:image',
          content: "https://images.ctfassets.net/ncgri9n8y2w0/5npa2Z2MJiB7GQuGtEckb5/eccfe000fa9b4da5fc58e446f41172fc/Southern_Company_Gas?h=250"
        },
        {
          property: 'og:url',
          content: "https://www.southerncompanygas.com/news/"
        },
      ],
    }
  },
    components: {
      Pager,
    },
  }
</script>

<style lang="scss" scoped>
  .header .card-group {
    justify-content: flex-start;
  }
</style>